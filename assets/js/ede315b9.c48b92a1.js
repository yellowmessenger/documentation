"use strict";(self.webpackChunkbenthos=self.webpackChunkbenthos||[]).push([[49803],{603905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(667294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=l(n),m=o,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||r;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[c]="string"==typeof e?e:o,s[1]=i;for(var l=2;l<r;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},593227:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return c}});var a=n(487462),o=n(263366),r=(n(667294),n(603905)),s=["components"],i={title:"Send, receive and parse API responses",sidebar_label:"Use APIs in AI-agent conversations"},p=void 0,l={unversionedId:"platform_concepts/studio/api/send-receive-apiresponses",id:"platform_concepts/studio/api/send-receive-apiresponses",title:"Send, receive and parse API responses",description:"The API node allows you to connect the APIs you added, make requests, get responses, and present the information to the customer in a way they can understand.",source:"@site/docs/platform_concepts/studio/api/send-receive-apiresponses.md",sourceDirName:"platform_concepts/studio/api",slug:"/platform_concepts/studio/api/send-receive-apiresponses",permalink:"/docs/platform_concepts/studio/api/send-receive-apiresponses",draft:!1,tags:[],version:"current",frontMatter:{title:"Send, receive and parse API responses",sidebar_label:"Use APIs in AI-agent conversations"},sidebar:"platform_concepts",previous:{title:"Add APIs via API node",permalink:"/docs/platform_concepts/studio/api/add-api-apinode"},next:{title:"Add API keys and access tokens",permalink:"/docs/platform_concepts/studio/api/bearer-token"}},d={},c=[{value:"Send data and handle responses",id:"send-data-and-handle-responses",level:2},{value:"Sending diverse data forms through API",id:"sending-diverse-data-forms-through-api",level:3},{value:"Use base64 URL conversion for files",id:"use-base64-url-conversion-for-files",level:4},{value:"Pass Array/Object variable in JSON",id:"pass-arrayobject-variable-in-json",level:4},{value:"Parse API responses",id:"parse-api-responses",level:2},{value:"Parse API response within the API node",id:"parse-api-response-within-the-api-node",level:3},{value:"Code snippet for parsing",id:"code-snippet-for-parsing",level:3},{value:"Parse API response using Function node",id:"parse-api-response-using-function-node",level:3}],u={toc:c};function m(e){var t=e.components,n=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#display-api-response"},"API node")," allows you to connect the APIs you added, make requests, get responses, and present the information to the customer in a way they can understand."),(0,r.kt)("h2",{id:"send-data-and-handle-responses"},"Send data and handle responses"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go to ",(0,r.kt)("strong",{parentName:"p"},"Automation")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/Flows/journeys"},"build a flow")," for your use case.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Include the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#display-api-response"},"API node")," at whichever point of the conversation you want the AI-agent to access API."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/heDgub5.png",alt:null}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click the ",(0,r.kt)("strong",{parentName:"p"},"API node")," and choose the option by which you want to add the API. To know about each option in detail, click ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode"},"here"),"."),(0,r.kt)("img",{src:"https://i.imgur.com/Fnsvd0z.png",alt:"drawing",width:"70%"})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The API details (it can be receiving an API response or sending data to another API) get auto-populated in the node. If you are collecting dynamic information from clients and sending them to an API, ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/nodes/prompt-nodes"},"add a node"),", collect that information and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/bot-variables#store-data-in-variables"},"store it in a variable"),". Pass that variable here under ",(0,r.kt)("strong",{parentName:"p"},"Dynamic variable configuration"),"."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/jl5DNLS.png",alt:null}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Test the API response, for steps, click ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#test-the-api"},"here"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Store the API response in a variable for future use. Click ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#store-the-api-response"},"here")," for the steps.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Display the API response to the end user by following the steps mentioned ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#display-api-response"},"here"),"."))),(0,r.kt)("h3",{id:"sending-diverse-data-forms-through-api"},"Sending diverse data forms through API"),(0,r.kt)("p",null,"When sending a request to an API through Yellow.ai, there are versatile methods for passing data. You can transmit images by converting them into base64 URLs, and directly pass arrays or object variables in JSON format."),(0,r.kt)("h4",{id:"use-base64-url-conversion-for-files"},"Use base64 URL conversion for files"),(0,r.kt)("p",null,"When dealing with tasks like uploading images, videos, or various file formats, the conversion of images into a readable string is a practical approach. This string, generated through Base64 encoding, facilitates easy transfer and utilization across different platforms."),(0,r.kt)("p",null,"Use the following code inside a body/params:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Pass URL"),(0,r.kt)("th",{parentName:"tr",align:null},"Format"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Directly"),(0,r.kt)("td",{parentName:"tr",align:null},"$$toBase64(url)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Through variable"),(0,r.kt)("td",{parentName:"tr",align:null},"$$toBase64({{{url}}})")))),(0,r.kt)("p",null,"   ",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/v3h6ruH.png",alt:null})),(0,r.kt)("h4",{id:"pass-arrayobject-variable-in-json"},"Pass Array/Object variable in JSON"),(0,r.kt)("p",null,"You need to pass the JSON file or the details to be entered as an array/object."),(0,r.kt)("p",null,"For instance, as shown in the screenshot below, ",(0,r.kt)("strong",{parentName:"p"},"Details_1")," can alternatively be represented as ",(0,r.kt)("strong",{parentName:"p"},"Details_2")," by storing array details in the array_details variable."),(0,r.kt)("p",null,"   ",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/41MaV4r.png",alt:null})),(0,r.kt)("h2",{id:"parse-api-responses"},"Parse API responses"),(0,r.kt)("p",null,"Yellow.ai provides an option to parse the API responses you recieve. To parse an API repsonse you need to write a custom logic that filters out the necessary data from your response. Then using a message node you can display that to the end-user. "),(0,r.kt)("p",null,"There are two ways by which you can parse an API response in Yellow.ai."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#parse-api-response-within-the-api-node"},"Parse API response within the API node")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#parse-api-response-using-function-node"},"Parse API response using Function node"))),(0,r.kt)("h3",{id:"parse-api-response-within-the-api-node"},"Parse API response within the API node"),(0,r.kt)("p",null,"You can parse an API response as you recieve it and display only the required info to the end user."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/Flows/journeys"},"Build a flow")," for your use case, include an ",(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#display-api-response"},"API node"),". ",(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#store-the-api-response"},"Store the response of the API node in a variable"),"."),(0,r.kt)("li",{parentName:"ol"},"Go to the ",(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/code"},"Functions")," section, fetch the variable created in the previous step and ",(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/code#create-a-new-function"},"write a custom logic")," to parse the API response. ")),(0,r.kt)("h3",{id:"code-snippet-for-parsing"},"Code snippet for parsing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"return new Promise\n  (resolve => {\n    // For transfromation function tagged in API Node, To fetch api response\n    const response = ymLib.args.apiResponse;\n    // Your logic here \n    // Any value returned (or promisified value) - is stored in AI-agent Variable storing API response\n    \n    return resolve(<parsed response>);\n  });         \n       \n")),(0,r.kt)("p",null,"For example, to extract only the weather description from the following API response you can write a custom logic as mentioned below."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"API Response:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "coord": {\n    "lon": 80.2785,\n    "lat": 13.0878\n  },\n  "weather": [\n    {\n      "id": 721,\n      "main": "Haze",\n      "description": "haze",\n      "icon": "50d"\n    }\n  ],\n  "base": "stations",\n  "main": {\n    "temp": 304.14,\n    "feels_like": 310.72,\n    "temp_min": 304.14,\n    "temp_max": 304.14,\n    "pressure": 1004,\n    "humidity": 70\n  },\n  "visibility": 5000,\n  "wind": {\n    "speed": 4.12,\n    "deg": 240\n  },\n  "clouds": {\n    "all": 75\n  },\n  "dt": 1701769926,\n  "sys": {\n    "type": 1,\n    "id": 9218,\n    "country": "IN",\n    "sunrise": 1701737256,\n    "sunset": 1701778274\n  },\n  "timezone": 19800,\n  "id": 1264527,\n  "name": "Chennai",\n  "cod": 200\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Custom Logic:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"return new Promise(resolve => {\n  let apiResponse = ymLib.args.apiResponse; // fetch API response\n  let body;\n  if (apiResponse && apiResponse.body) {\n    body = JSON.parse(apiResponse.body); // parse API response and store it in the body variable\n  }\n  resolve(body);\n});\n\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go back to the API node and click ",(0,r.kt)("strong",{parentName:"p"},"Test response"),"."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/kl7A0Ch.png",alt:null}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Scroll down to ",(0,r.kt)("strong",{parentName:"p"},"Parse using function")," and add the following:"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/KY3qGe8.png",alt:null})))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Select variable"),": Create/choose the variable in which you want to store the parsed response."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Add function"),": Choose the function created in step 2.")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Include a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/nodes/message-nodes"},"message node")," and pass the variable created in step 4 to display the info to the end user."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/nFxjCfO.png",alt:null})))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"When you test this API within the node, it will not return the expected output. However, when you pass the response in a message node to the end user, it will show the output."),(0,r.kt)("li",{parentName:"ul"},"The data type of the variable in which you store the response and data type of the API response should be the same."))),(0,r.kt)("h3",{id:"parse-api-response-using-function-node"},"Parse API response using Function node"),(0,r.kt)("p",null,"You can also parse an API response via Function node by passing the function in a separate node."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to the ",(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/code"},"Functions")," section and ",(0,r.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/code#create-a-new-function"},"write a custom logic")," to parse the API response. ")),(0,r.kt)("p",null,"For example, to extract only the weather description and temperature from the following API response you can write a custom logic as mentioned below."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"API Response:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n"coord":\n{\n"lon": 80.2785,\n"lat": 13.0878\n},\n"weather": [\n{\n"id": 721,\n"main": "Haze",\n"description": "haze",\n"icon": "50d"\n}\n],\n"base": "stations",\n"main": {\n"temp": 304.14,\n"feels_like": 310.72,\n"temp_min": 304.14,\n"temp_max": 304.14,\n"pressure": 1004,\n"humidity": 70\n},\n"visibility": 5000,\n"wind": {\n"speed": 4.12,\n"deg": 240\n},\n"clouds": {\n"all": 75\n},\n"dt": 1701769926,\n"sys":\n{\n"type": 1,\n"id": 9218,\n"country": "IN",\n"sunrise": 1701737256,\n"sunset": 1701778274\n},\n"timezone": 19800,\n"id": 1264527,\n"name": "Chennai",\n"cod": 200\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Custom Logic:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"return new Promise(resolve => {\nlet weatherResponse = data.variables.weather_response;\nlet weatherDescription = weatherResponse.weather[0].description;\nlet temperature = weatherResponse.main.temp;\nlet output = {\nweatherDescription: weatherDescription,\ntemperature: temperature\n};\nresolve(output);\n});\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go to ",(0,r.kt)("strong",{parentName:"p"},"Automation")," > ",(0,r.kt)("strong",{parentName:"p"},"Build")," > to the respective flow and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api-apinode#store-the-api-response"},"store the response of this API node in a variable"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/nodes/action-nodes#24-function"},"function node")," to the flow and pass the function you created in step 1. ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/bot-variables#store-data-in-variables"},"Store the response of this function node in a variable")," depending on its data type."),(0,r.kt)("img",{src:"https://i.imgur.com/4PTK4Q9.png",alt:"drawing",width:"90%"})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Include a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.yellow.ai/docs/platform_concepts/studio/build/nodes/message-nodes"},"message node")," and pass the variable in which you stored the function's reponse with the syntax that displays the required data to the customer."),(0,r.kt)("img",{src:"https://i.imgur.com/Wf4cnkD.png",alt:"drawing",width:"100%"}))))}m.isMDXComponent=!0}}]);