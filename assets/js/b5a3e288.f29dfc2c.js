"use strict";(self.webpackChunkbenthos=self.webpackChunkbenthos||[]).push([[52132],{603905:function(t,e,n){n.d(e,{Zo:function(){return s},kt:function(){return h}});var a=n(667294);function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,o=function(t,e){if(null==t)return{};var n,a,o={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var p=a.createContext({}),d=function(t){var e=a.useContext(p),n=e;return t&&(n="function"==typeof t?t(e):r(r({},e),t)),n},s=function(t){var e=d(t.components);return a.createElement(p.Provider,{value:e},t.children)},c="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(t,e){var n=t.components,o=t.mdxType,i=t.originalType,p=t.parentName,s=l(t,["components","mdxType","originalType","parentName"]),c=d(n),m=o,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(h,r(r({ref:e},s),{},{components:n})):a.createElement(h,r({ref:e},s))}));function h(t,e){var n=arguments,o=e&&e.mdxType;if("string"==typeof t||o){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var p in e)hasOwnProperty.call(e,p)&&(l[p]=e[p]);l.originalType=t,l[c]="string"==typeof t?t:o,r[1]=l;for(var d=2;d<i;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},369319:function(t,e,n){n.r(e),n.d(e,{assets:function(){return s},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return c}});var a=n(487462),o=n(263366),i=(n(667294),n(603905)),r=["components"],l={title:"Android push notifications",sidebar_label:"Android push notifications"},p=void 0,d={unversionedId:"platform_concepts/channelConfiguration/android_push",id:"platform_concepts/channelConfiguration/android_push",title:"Android push notifications",description:"Configure Android push notification",source:"@site/docs/platform_concepts/channelConfiguration/android_push.md",sourceDirName:"platform_concepts/channelConfiguration",slug:"/platform_concepts/channelConfiguration/android_push",permalink:"/docs/platform_concepts/channelConfiguration/android_push",draft:!1,tags:[],version:"current",frontMatter:{title:"Android push notifications",sidebar_label:"Android push notifications"},sidebar:"platform_concepts",previous:{title:"Push notifications",permalink:"/docs/platform_concepts/channelConfiguration/mobilepush"},next:{title:"iOS push notifications",permalink:"/docs/platform_concepts/channelConfiguration/ios_push"}},s={},c=[{value:"Configure Android push notification",id:"configure-android-push-notification",level:2},{value:"Step 1: Add project to FCM &amp; generate private key",id:"step-1-add-project-to-fcm--generate-private-key",level:3},{value:"Step 2: Add key to Yellow.ai",id:"step-2-add-key-to-yellowai",level:3},{value:"Code snippets for Android Push notifications",id:"code-snippets-for-android-push-notifications",level:2},{value:"Notification without custom action",id:"notification-without-custom-action",level:3},{value:"Notification with deep link",id:"notification-with-deep-link",level:3},{value:"Notification with bot response",id:"notification-with-bot-response",level:3},{value:"Payload to trigger bot flow",id:"payload-to-trigger-bot-flow",level:4},{value:"Payload to open the bot with a predefined response",id:"payload-to-open-the-bot-with-a-predefined-response",level:4},{value:"Implementation codes for Android app developer",id:"implementation-codes-for-android-app-developer",level:2},{value:"Fetch additional data from notifications when clicked",id:"fetch-additional-data-from-notifications-when-clicked",level:3},{value:"Start chatbot with bot details and additional data",id:"start-chatbot-with-bot-details-and-additional-data",level:3},{value:"Handle notifications in the foreground when the bot is closed",id:"handle-notifications-in-the-foreground-when-the-bot-is-closed",level:3}],u={toc:c};function m(t){var e=t.components,n=(0,o.Z)(t,r);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"configure-android-push-notification"},"Configure Android push notification"),(0,i.kt)("h3",{id:"step-1-add-project-to-fcm--generate-private-key"},"Step 1: Add project to FCM & generate private key"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Log on to the ",(0,i.kt)("a",{parentName:"p",href:"https://console.firebase.google.com/"},"Firebase Developer Console")," and add Firebase to your ",(0,i.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/android/setup"},"Android app"),".\n",(0,i.kt)("img",{parentName:"p",src:"https://i.imgur.com/wWLefrH.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In Project settings, navigate to ",(0,i.kt)("strong",{parentName:"p"},"Service accounts"),"."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{parentName:"p",src:"https://i.imgur.com/3Z1ga3w.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click on ",(0,i.kt)("strong",{parentName:"p"},"Generate new private key"),". A JSON file will be downloaded which contains all the credentials."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{parentName:"p",src:"https://i.imgur.com/Qzdl7Cf.png",alt:null})))),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"To set up Firebase Cloud Messaging client app on Android,  see the ",(0,i.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/android/client"},"Firebase official documentation"),".")),(0,i.kt)("h3",{id:"step-2-add-key-to-yellowai"},"Step 2: Add key to Yellow.ai"),(0,i.kt)("p",null,"Once you get the key JSON file, upload the key on Yellow.ai to establish a connection and grant access to send push notifications from Yellow.ai."),(0,i.kt)("p",null,"To connect FCM to yellow.ai, follow these steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"On the left navigation bar, click ",(0,i.kt)("strong",{parentName:"p"},"Extensions"),"."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{parentName:"p",src:"https://imgur.com/PIOvT6K.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Channels")," > ",(0,i.kt)("strong",{parentName:"p"},"Push Notifications")," > ",(0,i.kt)("strong",{parentName:"p"},"Android (FCM)"),". "),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{parentName:"p",src:"https://imgur.com/LAsXF6T.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"+ Connect your account"),"."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{parentName:"p",src:"https://imgur.com/zrtg4lV.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Cick ",(0,i.kt)("strong",{parentName:"p"},"Upload")," and choose the downloaded JSON file from your local folder and click ",(0,i.kt)("strong",{parentName:"p"},"Add"),"."),(0,i.kt)("img",{src:"https://imgur.com/g0eAcCC.png",alt:"drawing",width:"70%"}))),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"To know how to create a push notification campaign, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/platform_concepts/engagement/outbound/templates/mobilepush"},"Mobile push template"),".")),(0,i.kt)("h2",{id:"code-snippets-for-android-push-notifications"},"Code snippets for Android Push notifications"),(0,i.kt)("p",null,"Notifications are sent to Firebase which then pushes them to the app using the user's device token. This section provides payloads that are sent to Firebase for different on-tap actions (action performed when the user taps on the push notification)."),(0,i.kt)("p",null,"The following table provides descriptions of different parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Datatype"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"notification"),(0,i.kt)("td",{parentName:"tr",align:null},"Object"),(0,i.kt)("td",{parentName:"tr",align:null},"Details of the notification")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"title"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"Title of the notification.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"body"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"Content of the notification.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"payload"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"Contains additional parameters such as image, botId, deeplink and journeySlug.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"botId"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"The bot ID for which the notification has been triggered.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"image"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"Path of the image file or URL of the image.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"deeplink"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"URL which redirects the user to a particular page of the application.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"journeySlug"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the journey which has to be triggered in the bot, when the user taps on the notification")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"token*"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"A unique identifier or device ID generated for the operating system and specific device. Notifications are sent to the user's device ID.")))),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"Parameters with * are mandatory."),(0,i.kt)("li",{parentName:"ul"},"Either ",(0,i.kt)("inlineCode",{parentName:"li"},"deviceToken")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"ymAuthToken")," is needed. For campaigns, ",(0,i.kt)("inlineCode",{parentName:"li"},"deviceToken")," is mandatory and ",(0,i.kt)("inlineCode",{parentName:"li"},"ymAuthToken")," is optional. ",(0,i.kt)("br",null),"However, to push notifications from from your app to User 360, only ",(0,i.kt)("inlineCode",{parentName:"li"},"ymAuthToken")," is required."),(0,i.kt)("li",{parentName:"ul"},"Ensure you create users along with their device and ym authentication tokens."),(0,i.kt)("li",{parentName:"ul"},"When sending out notifications, the yellow.ai consumes these details automatically, decides the platform, and sends out notifications accordingly."))),(0,i.kt)("h3",{id:"notification-without-custom-action"},"Notification without custom action"),(0,i.kt)("p",null,"This is used to redirect to the main activity of the app when a user clicks on the notification - On tap action, open the app (your app). See Step 7 of ",(0,i.kt)("a",{parentName:"p",href:"/docs/platform_concepts/engagement/outbound/templates/mobilepush"},"Push notification template"),"."),(0,i.kt)("p",null,"We do not send any payload, instead, we just trigger the notification containing the title and body along with the image (if included). There is no action included in the payload."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n    "notification": {\n        "title": "Hey there",\n        "body": "Body",\n        "image": "{ImageUrl}"\n    },\n    "token": "{deviceToken}"\n}\n')),(0,i.kt)("h3",{id:"notification-with-deep-link"},"Notification with deep link"),(0,i.kt)("p",null,"This is used for the On tap action to open a deep link to the app - when a user clicks on the notification, it redirects to a specific screen of the app where the deeplink is pointing to."),(0,i.kt)("p",null,"The payload consists of the standard notification details (title, body, and image) along with the ",(0,i.kt)("inlineCode",{parentName:"p"},"botId")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"deeplink")," URI."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n    "notification": {\n        "title": "Hey there",\n        "body": "Body",\n        "image": "{imageUrl}"\n    },\n    "data": {\n        "botId": {botId},\n        "deeplink": "{uri}"\n    },\n    "token": "{deviceToken}"\n}\n')),(0,i.kt)("h3",{id:"notification-with-bot-response"},"Notification with bot response"),(0,i.kt)("p",null,"This is used for the On tap action to open a specific bot flow - when a user clicks on the notification, it opens the bot that can ",(0,i.kt)("a",{parentName:"p",href:"#payload-to-trigger-bot-flow"},"trigger a specific bot flow")," or ",(0,i.kt)("a",{parentName:"p",href:"#payload-to-open-the-bot-with-a-predefined-response"},"shows a predefined response"),"."),(0,i.kt)("h4",{id:"payload-to-trigger-bot-flow"},"Payload to trigger bot flow"),(0,i.kt)("p",null,"Here is the payload to trigger a specific bot flow when the user clicks on the notification."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n    "notification": {\n        "title": "Hey there",\n        "body": "Body",\n        "image": "{imageUrl}"\n    },\n    "data": {\n        "botId": "{botId}",\n        "journeySlug": "{slug}"\n    },\n    "token": "{deviceToken}"\n}\n')),(0,i.kt)("h4",{id:"payload-to-open-the-bot-with-a-predefined-response"},"Payload to open the bot with a predefined response"),(0,i.kt)("p",null,"Here is the payload to show a specific bot response (text message) when the user clicks on the notification."),(0,i.kt)("p",null,"It just contains ",(0,i.kt)("inlineCode",{parentName:"p"},"botId")," in the response under the ",(0,i.kt)("inlineCode",{parentName:"p"},"data")," parameter. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n    "notification": {\n        "title": "Hey there",\n        "body": "Body",\n        "image": "{imageUrl}"\n    },\n    "data": {\n        "botId": "{botId}",\n    },\n    "token": "{deviceToken}"\n}\n')),(0,i.kt)("h2",{id:"implementation-codes-for-android-app-developer"},"Implementation codes for Android app developer"),(0,i.kt)("p",null,"The following are the code snippets for the Android app developer to get the notifications and handle different scenarios."),(0,i.kt)("h3",{id:"fetch-additional-data-from-notifications-when-clicked"},"Fetch additional data from notifications when clicked"),(0,i.kt)("p",null,"Use the following code snippet fetch additional information from the user when the user clicks on the notification."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'HashMap < String, Object > payloadData = new HashMap < > ();\nHashMap < String, Object > botPayloadData = new HashMap < > ();\n\nBundle bundle = getIntent().getExtras();\nif (bundle != null) {\n    String tmp = "";\n    for (String key: bundle.keySet()) {\n        Object value = bundle.get(key);\n        payloadData.put(key, value);\n        tmp += key + ": " + value + "\\n\\n";\n    }\n    mTextView.setText(tmp);\n}\n')),(0,i.kt)("h3",{id:"start-chatbot-with-bot-details-and-additional-data"},"Start chatbot with bot details and additional data"),(0,i.kt)("p",null,"Use the following code snippet to open the bot and trigger a specific bot flow when the user clicks on the notification. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'if (payloadData.get("botId") != null) {\n    String botId = (String) payloadData.get("botId");\n    YMChat ymChat = YMChat.getInstance();\n\n    ymChat.config = new YMConfig(botId);\n    ymChat.config.version = 2;\n    ymChat.config.ymAuthenticationToken = "2gs20emoof1666164936076";\n\n    if (payloadData.get("journeySlug") != null) {\n        String journeySlug = (String) payloadData.get("journeySlug");\n        botPayloadData.put("JourneySlug", journeySlug);\n        ymChat.config.payload = botPayloadData;\n    }\n\n    try {\n        ymChat.startChatbot(this);\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n}\n')),(0,i.kt)("h3",{id:"handle-notifications-in-the-foreground-when-the-bot-is-closed"},"Handle notifications in the foreground when the bot is closed"),(0,i.kt)("p",null,"Use the following code snippet to handle the notifications you receive when the app is open in the foreground."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import android.util.Log\nimport com.google.firebase.messaging.FirebaseMessagingService\nimport com.google.firebase.messaging.RemoteMessage\n\nclass MyFirebaseMessagingService: FirebaseMessagingService() {\n    final\n    var TAG: String = "YMLog"\n    override fun onMessageReceived(remoteMessage: RemoteMessage) {\n        Log.i(TAG + " Remote message", remoteMessage.toString())\n        Log.i(TAG + " Remote message", remoteMessage.data.toString())\n        super.onMessageReceived(remoteMessage)\n    }\n}\n')),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"For more details regarding the integration, see "),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/mobile/chatbot/android"},"Android SDK documentation"),". "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/yellowmessenger/YmChatBot-Android-DemoApp"},"Test app with Android SDK and Firebase integration")))))}m.isMDXComponent=!0}}]);